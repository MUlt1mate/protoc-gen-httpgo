syntax = "proto3";

package example;
option go_package = "github.com/MUlt1mate/protoc-gen-httpgo/example/proto;proto";

import "google/api/annotations.proto";
import "google/protobuf/empty.proto";
import "google/protobuf/any.proto";
import "common/structs.proto";

// here we check all variable types
service ServiceName {
  rpc RPCName (common.InputMsgName) returns (common.OutputMsgName) {
    option (google.api.http) = {
      post: "/v1/test/{stringArgument}/{int64Argument}"
    };
  }
  rpc AllTypesTest (common.AllTypesMsg) returns (common.AllTypesMsg) {
    option (google.api.http) = {
      post: "/v1/test/{BoolValue}/{EnumValue}/{Int32Value}/{Sint32Value}/{Uint32Value}/{Int64Value}/{Sint64Value}/{Uint64Value}/{Sfixed32Value}/{Fixed32Value}/{FloatValue}/{Sfixed64Value}/{Fixed64Value}/{DoubleValue}/{StringValue}/{BytesValue}"
    };
  }
  rpc AllTextTypesPost (common.AllTextTypesMsg) returns (common.AllTextTypesMsg) {
    option (google.api.http) = {
      post: "/v1/text/{String}/{RepeatedString}/{Bytes}/{RepeatedBytes}/{Enum}/{RepeatedEnum}"
    };
  }
  rpc AllTextTypesGet (common.AllTextTypesMsg) returns (common.AllTextTypesMsg) {
    option (google.api.http) = {
      get: "/v2/text/{String}/{RepeatedString}/{Bytes}/{RepeatedBytes}/{Enum}/{RepeatedEnum}"
    };
  }
  rpc CommonTypes (google.protobuf.Any) returns (google.protobuf.Empty) {
    option (google.api.http) = {
      post: "/v1/test/commonTypes"
    };
  }
  // same types but different query, we need different query builder function
  rpc sameInputAndOutput (common.InputMsgName) returns (common.OutputMsgName) {
    option (google.api.http) = {
      post: "/v1/test/{stringArgument}"
    };
  }
  // should be ignored
  rpc methodWithoutPath (common.InputMsgName) returns (common.OutputMsgName) {}
  // should be ignored
  rpc streams(stream common.InputMsgName) returns (stream common.OutputMsgName){
    option (google.api.http) = {
      post: "/v1/test/stream"
    };
  };
  rpc optional(common.OptionalField) returns (common.OptionalField){
    option (google.api.http) = {
      post: "/v1/test/optional"
    };
  };
  rpc GetMethod(common.InputMsgName) returns (common.OutputMsgName){
    option (google.api.http) = {
      get: "/v1/test/get"
    };
  };
  rpc CheckRepeatedPath(common.RepeatedCheck) returns (common.RepeatedCheck){
    option (google.api.http) = {
      get: "/v1/repeated/{BoolValue}/{EnumValue}/{Int32Value}/{Sint32Value}/{Uint32Value}/{Int64Value}/{Sint64Value}/{Uint64Value}/{Sfixed32Value}/{Fixed32Value}/{FloatValue}/{Sfixed64Value}/{Fixed64Value}/{DoubleValue}/{StringValue}/{BytesValue}/{StringValueQuery}"
    };
  };
  rpc CheckRepeatedQuery(common.RepeatedCheck) returns (common.RepeatedCheck){
    option (google.api.http) = {
      get: "/v1/repeated/{StringValue}"
    };
  };
  rpc CheckRepeatedPost(common.RepeatedCheck) returns (common.RepeatedCheck){
    option (google.api.http) = {
      post: "/v1/repeated/{StringValue}"
    };
  };
  rpc EmptyGet(common.Empty) returns (common.Empty){
    option (google.api.http) = {
      get: "/v1/emptyGet"
    };
  };
  rpc EmptyPost(common.Empty) returns (common.Empty){
    option (google.api.http) = {
      post: "/v1/emptyPost"
    };
  };
  rpc OnlyStructInGet(common.OnlyStruct) returns (common.Empty){
    option (google.api.http) = {
      post: "/v1/onlyStruct"
    };
  };
  rpc MultipartForm(common.MultipartFormRequest) returns (common.Empty){
    option (google.api.http) = {
      post: "/v1/multipart"
    };
  };
  rpc MultipartFormAllTypes(common.MultipartFormAllTypes) returns (common.Empty){
    option (google.api.http) = {
      post: "/v1/multipartall"
    };
  };
  rpc AllTypesMaxTest (common.AllNumberTypesMsg) returns (common.AllNumberTypesMsg) {
    option (google.api.http) = {
      get: "/v1/max/{Int32Value}/{Uint32Value}/{Int64Value}/{Uint64Value}/{FloatValue}/{DoubleValue}"
    };
  }
  rpc AllTypesMaxQueryTest (common.AllNumberTypesMsg) returns (common.AllNumberTypesMsg) {
    option (google.api.http) = {
      get: "/v1/maxquery"
    };
  }

  // http rule checks
  // v1/{name=messages/*}
  rpc GetMessage(common.GetMessageRequest) returns (common.Message) {
    option (google.api.http) = {
      get: "/v1/{name=messages/*}"
    };
  }
  rpc GetMessageV2(common.GetMessageRequestV2) returns (common.Message) {
    option (google.api.http) = {
      get:"/v2/messages/{message_id}"
    };
  }
  rpc UpdateMessage(common.UpdateMessageRequest) returns (common.Message) {
    option (google.api.http) = {
      patch: "/v1/messages/{message_id}"
      body: "message"
    };
  }
  rpc UpdateMessageV2(common.MessageV2) returns (common.MessageV2) {
    option (google.api.http) = {
      patch: "/v2/messages/{message_id}"
      body: "*"
    };
  }
  rpc GetMessageV3(common.GetMessageRequestV3) returns (common.MessageV2) {
    option (google.api.http) = {
      get: "/v3/messages/{message_id}"
      additional_bindings {
        get: "/v3/users/{user_id}/messages/{message_id}"
      }
    };
  }
  rpc GetMessageV4(common.GetMessageRequestV3) returns (common.MessageV2) {
    option (google.api.http) = {
      get: "/v4/messages/{message_id=base/**}"
    };
  }
  rpc TopLevelArray(common.Array) returns (common.Array){
    option (google.api.http) = {
      post: "/v1/array",
      response_body: "items"
    };
  };
  rpc UpdateMessageV3(common.UpdateMessageRequest) returns (common.UpdateMessageRequest){
    option (google.api.http) = {
      patch: "/v3/messages"
      body: "*"
      response_body: "message"
    };
  };
}
